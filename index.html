<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chief Flex Giveaway â€“  ğŸ˜…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <!-- Supabase JS v2 (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      background:
        radial-gradient(circle at top, #4c1d95 0, #020617 45%) fixed,
        radial-gradient(circle at bottom, #064e3b 0, #020617 55%) fixed;
      overflow-x: hidden;
      cursor: crosshair;
    }

    @keyframes floaty {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes glowPulse {
      0%, 100% { box-shadow: 0 0 10px rgba(129, 230, 217, 0.5); }
      50% { box-shadow: 0 0 22px rgba(129, 230, 217, 1); }
    }
    @keyframes popFade {
      0% { transform: scale(0.7); opacity: 0; }
      50% { transform: scale(1.08); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    @keyframes leaderboardSlide {
      0% { opacity: 0; transform: translateY(18px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes crownBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }
    @keyframes sparkleFly {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-30px) scale(0.4); }
    }
    @keyframes pulseDot {
      0%, 100% { opacity: 0.2; transform: translateY(0); }
      50% { opacity: 1; transform: translateY(-3px); }
    }
    @keyframes slotSpin {
      0% { transform: translateY(0); }
      100% { transform: translateY(-100%); }
    }

    .floaty { animation: floaty 3s ease-in-out infinite; }
    .glow-pulse { animation: glowPulse 2.2s ease-in-out infinite; }
    .pop-in { animation: popFade 0.4s ease-out forwards; }
    .slide-in { animation: leaderboardSlide 0.4s ease-out forwards; }
    .crown-bounce { animation: crownBounce 1s ease-in-out infinite; }

    .fun-btn { transition: transform 0.12s ease, box-shadow 0.12s ease; }
    .fun-btn:hover { transform: scale(1.05) rotate(-1deg); box-shadow: 0 0 25px rgba(96, 165, 250, 0.5); }
    .fun-btn:active { transform: scale(0.95); }

    .sparkle {
      position: fixed;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      pointer-events: none;
      background: radial-gradient(circle, #fbbf24, #f97316, #ec4899);
      animation: sparkleFly 0.6s ease-out forwards;
      z-index: 40;
    }

    .dot-1, .dot-2, .dot-3 { animation: pulseDot 0.8s infinite; }
    .dot-2 { animation-delay: 0.2s; }
    .dot-3 { animation-delay: 0.4s; }

    .slot-window {
      overflow: hidden;
      height: 28px;
    }
    .slot-strip {
      animation: slotSpin 0.5s linear infinite;
    }
  </style>
</head>
<body class="min-h-screen text-slate-50 flex items-center justify-center p-4">

  <div class="w-full max-w-xl mx-auto">

    <div class="text-center mb-6">
      <h1 class="text-4xl md:text-5xl font-black tracking-tight text-white drop-shadow-xl floaty">
        Chief Flex Giveaway ğŸ
      </h1>
      <p class="mt-2 text-slate-200 text-sm md:text-base">
        Be in the first <span class="font-bold text-emerald-300">two</span> or go find your name on the leaderboard ğŸ˜…
      </p>
    </div>

    <div class="relative bg-slate-900/70 border border-slate-700 rounded-3xl shadow-[0_25px_60px_rgba(0,0,0,0.75)] p-7 md:p-9 backdrop-blur-xl overflow-hidden glow-pulse">

      <!-- blobs -->
      <div class="absolute -top-16 -right-10 w-48 h-48 bg-purple-500/25 rounded-full blur-3xl"></div>
      <div class="absolute -bottom-16 -left-10 w-48 h-48 bg-emerald-500/25 rounded-full blur-3xl"></div>

      <!-- PAGE: FORM -->
      <section id="page-form" class="app-page pop-in relative z-10">
        <h2 class="text-xl md:text-2xl font-bold mb-4 flex items-center gap-2">
          <span class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-gradient-to-r from-sky-400 to-emerald-300 text-slate-900 text-xs font-black">
            STEP 1
          </span>
          Enter the Arena âš”ï¸
        </h2>

        <form id="entry-form" class="space-y-4 mt-3">
          <input
            id="username"
            placeholder="Username (@saifyusuph)"
            class="w-full px-4 py-3 rounded-xl bg-slate-900/80 border border-slate-700 placeholder-slate-500 focus:ring-2 focus:ring-emerald-400 focus:border-transparent text-sm"
          />
          <input
            id="fullname"
            placeholder="Full Name (S A Yusuf)"
            class="w-full px-4 py-3 rounded-xl bg-slate-900/80 border border-slate-700 placeholder-slate-500 focus:ring-2 focus:ring-emerald-400 focus:border-transparent text-sm"
          />
          <input
            id="email"
            placeholder="Email (chief@example.com)"
            class="w-full px-4 py-3 rounded-xl bg-slate-900/80 border border-slate-700 placeholder-slate-500 focus:ring-2 focus:ring-emerald-400 focus:border-transparent text-sm"
          />

          <button class="fun-btn w-full mt-2 py-3 rounded-xl bg-gradient-to-r from-amber-300 via-emerald-300 to-sky-300 text-slate-900 font-extrabold text-base md:text-lg">
            NEXT ğŸ‘‰
          </button>
        </form>

        <p class="mt-3 text-[11px] text-slate-400">
          Small game. Big bragging rights. No long talk. ğŸ˜Œ
        </p>
      </section>

      <!-- PAGE: WINNER -->
      <section id="page-winner" class="app-page hidden text-center relative z-10">
        <div class="inline-flex w-24 h-24 items-center justify-center rounded-full bg-emerald-500/20 border border-emerald-300 mb-5 floaty">
          <span class="text-4xl">ğŸ”¥</span>
        </div>

        <h2 class="text-3xl font-extrabold text-emerald-300 drop-shadow glow-pulse">
          Wow you made it cheif... ğŸ¤˜
        </h2>

        <p class="text-slate-200 text-sm mt-2 mb-4">
          You entered among the first two sharpest humans. Talk to us nice now. ğŸ˜
        </p>

        <div class="bg-slate-900/80 border border-emerald-400/50 rounded-2xl px-4 py-3 text-left max-w-xs mx-auto mt-2">
          <p class="text-xs text-slate-400 mb-1">Your Receipt</p>
          <p class="text-slate-100 text-sm"><span class="font-semibold">Username:</span> <span id="winner-username"></span></p>
          <p class="text-slate-100 text-sm"><span class="font-semibold">Position:</span> <span id="winner-position"></span></p>
        </div>

        <button
          id="winner-view-leaderboard"
          class="fun-btn mt-6 px-6 py-3 rounded-xl border border-slate-600 bg-slate-800/70 text-slate-100 text-sm md:text-base hover:bg-slate-700/90"
        >
          View Leaderboard ğŸ“œ
        </button>
      </section>

      <!-- PAGE: LEADERBOARD -->
      <section id="page-leaderboard" class="app-page hidden relative z-10">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-extrabold text-white flex items-center gap-2">
            <span class="crown-bounce text-2xl">ğŸ‘‘</span>
            Leaderboard
          </h2>
          <button
            id="back-home"
            class="fun-btn px-3 py-1.5 rounded-full border border-slate-600 bg-slate-900/80 text-[11px] text-slate-200 hover:bg-slate-800"
          >
            Enter again ğŸ”
          </button>
        </div>

        <p class="text-xs text-slate-300 mb-3">
          Top spots are for those with fast fingers only. No VAR. No extra time. ğŸš€
        </p>

        <div class="overflow-hidden rounded-2xl border border-slate-700 bg-slate-950/70">
          <table class="w-full text-sm">
            <thead class="bg-slate-800/90 text-slate-300">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide">Pos</th>
                <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide">Username</th>
              </tr>
            </thead>
            <tbody id="leaderboard-body" class="divide-y divide-slate-800"></tbody>
          </table>
        </div>

        <p class="mt-3 text-[11px] text-slate-400 text-center">
          If you no see your username at top, no vex. Even Messi dey bench sometimes. ğŸ¥²
        </p>
      </section>

      <!-- TOAST -->
      <div id="toast" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="pop-in bg-slate-900/90 border border-slate-600 rounded-2xl px-6 py-4 text-center shadow-2xl max-w-xs w-[90%]">
          <p id="toast-message" class="text-sm md:text-base font-semibold text-slate-50"></p>
        </div>
      </div>

      <!-- CHECKING OVERLAY -->
      <div id="checking-overlay" class="fixed inset-0 bg-black/70 flex items-center justify-center z-40 hidden">
        <div class="pop-in bg-slate-900/95 border border-sky-500/60 rounded-3xl px-6 py-6 max-w-sm w-[90%] shadow-2xl text-center">
          <p class="text-xs text-sky-300 mb-1">Hold on chief...</p>
          <h3 class="text-xl font-extrabold text-white mb-2">
            Checking if you're top 2 ğŸ˜ˆ
          </h3>
          <div class="flex justify-center gap-1 mb-4 text-slate-300">
            <span class="dot-1">.</span>
            <span class="dot-2">.</span>
            <span class="dot-3">.</span>
          </div>
          <div class="flex items-center justify-center gap-3">
            <div class="slot-window w-14 rounded-lg border border-slate-600 bg-slate-800/90 text-emerald-300 font-mono text-lg flex items-center justify-center">
              <div class="slot-strip">
                <div>1</div><div>3</div><div>2</div><div>4</div><div>1</div>
              </div>
            </div>
            <div class="slot-window w-14 rounded-lg border border-slate-600 bg-slate-800/90 text-amber-300 font-mono text-lg flex items-center justify-center">
              <div class="slot-strip">
                <div>2</div><div>4</div><div>1</div><div>3</div><div>2</div>
              </div>
            </div>
            <div class="slot-window w-14 rounded-lg border border-slate-600 bg-slate-800/90 text-sky-300 font-mono text-lg flex items-center justify-center">
              <div class="slot-strip">
                <div>?</div><div>?</div><div>?</div><div>?</div><div>?</div>
              </div>
            </div>
          </div>
          <p class="mt-3 text-[11px] text-slate-400">
            Drum roll loading... ğŸ¥
          </p>
        </div>
      </div>

    </div>
  </div>

  <script>
    // === Supabase client setup ===
    const SUPABASE_URL = "https://kimriiyyorsygphphmvz.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtpbXJpaXl5b3JzeWdwaHBobXZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4MjIwNjUsImV4cCI6MjA4MDM5ODA2NX0.J7uzp1Fqz2jTmn10-KoboQ7akfDeeGgksaILJrRpuHU";

    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // === Helpers ===
    function showToast(message, duration = 1800, cb) {
      const toast = document.getElementById("toast");
      const msgEl = document.getElementById("toast-message");
      msgEl.textContent = message;
      toast.classList.remove("hidden");
      setTimeout(() => {
        toast.classList.add("hidden");
        if (typeof cb === "function") cb();
      }, duration);
    }

    function showPage(id) {
      document.querySelectorAll(".app-page").forEach(p => p.classList.add("hidden"));
      const target = document.getElementById(id);
      target.classList.remove("hidden");
      target.classList.remove("pop-in");
      void target.offsetWidth;
      target.classList.add("pop-in");
    }

    function fireConfetti() {
      if (typeof confetti !== "function") return;
      const duration = 1600;
      const end = Date.now() + duration;
      (function frame() {
        confetti({
          particleCount: 8,
          startVelocity: 25,
          spread: 60,
          origin: { x: Math.random(), y: Math.random() * 0.4 }
        });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
    }

    function showCheckingOverlay(cb) {
      const overlay = document.getElementById("checking-overlay");
      overlay.classList.remove("hidden");
      setTimeout(() => {
        overlay.classList.add("hidden");
        if (typeof cb === "function") cb();
      }, 1500);
    }

    // Sparkles
    document.addEventListener("mousemove", (e) => {
      if (Math.random() > 0.3) return;
      const s = document.createElement("div");
      s.className = "sparkle";
      s.style.left = e.clientX + "px";
      s.style.top = e.clientY + "px";
      document.body.appendChild(s);
      setTimeout(() => s.remove(), 600);
    });

    // === Leaderboard ===
    async function fetchLeaderboard() {
      const { data, error } = await supabaseClient
        .from("entries")
        .select("*")
        .order("created_at", { ascending: true });

      if (error) {
        console.error("Leaderboard error:", error);
        return [];
      }
      return data || [];
    }

    async function renderLeaderboard() {
      const tbody = document.getElementById("leaderboard-body");
      tbody.innerHTML = "";
      const entries = await fetchLeaderboard();

      if (!entries.length) {
        tbody.innerHTML = `
          <tr>
            <td class="px-4 py-4 text-center text-xs text-slate-400" colspan="2">
              Nobody don enter yet. Be the trailblazer now. ğŸ˜
            </td>
          </tr>
        `;
        return;
      }

      entries.forEach((entry, index) => {
        const pos = index + 1;
        const isTop1 = index === 0;
        const tr = document.createElement("tr");
        tr.className = "slide-in";
        tr.style.animationDelay = (index * 120) + "ms";

        tr.innerHTML = `
          <td class="px-4 py-3 text-xs md:text-sm font-bold ${isTop1 ? 'text-amber-300' : 'text-slate-100'}">
            #${pos}
          </td>
          <td class="px-4 py-3 text-xs md:text-sm text-slate-100 flex items-center gap-2">
            ${isTop1 ? '<span class="crown-bounce text-lg">ğŸ‘‘</span>' : ''}
            <span>${entry.username || "-"}</span>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // === Form handler ===
    const form = document.getElementById("entry-form");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const username = document.getElementById("username").value.trim();
      const fullname = document.getElementById("fullname").value.trim();
      const email = document.getElementById("email").value.trim();

      if (!username || !fullname || !email) {
        showToast("Oga abeg fill everything first ğŸ˜’");
        return;
      }
      if (!email.includes("@") || !email.includes(".")) {
        showToast("This your email dey somehow. Check am again ğŸ™ƒ");
        return;
      }

      showCheckingOverlay(async () => {
        const { data: insertedRows, error: insertError } = await supabaseClient
          .from("entries")
          .insert([{ username, fullname, email }])
          .select()
          .limit(1);

        if (insertError || !insertedRows || !insertedRows.length) {
          console.error("Insert error:", insertError);
          showToast("Network wahala. Try again small later ğŸ™");
          return;
        }

        const inserted = insertedRows[0];
        const allEntries = await fetchLeaderboard();
        const index = allEntries.findIndex(e => e.id === inserted.id);
        const position = index === -1 ? allEntries.length : index + 1;

        if (position <= 2) {
          fireConfetti();
          showToast("You made it, you rock! ğŸ¤˜", 1300, () => {
            document.getElementById("winner-username").textContent = username;
            document.getElementById("winner-position").textContent = "#" + position;
            showPage("page-winner");
          });
        } else {
          showToast("Eyya sorry ehn, next time buy Starlink ğŸ˜‚", 1800, async () => {
            await renderLeaderboard();
            showPage("page-leaderboard");
          });
        }
      });

      form.reset();
    });

    // === Buttons ===
    document.getElementById("back-home").addEventListener("click", () => {
      showPage("page-form");
    });

    document.getElementById("winner-view-leaderboard").addEventListener("click", async () => {
      await renderLeaderboard();
      showPage("page-leaderboard");
    });

    // Init
    document.addEventListener("DOMContentLoaded", async () => {
      showPage("page-form");
      await renderLeaderboard();
    });
  </script>
</body>
</html>
